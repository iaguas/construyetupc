var app=angular.module("app",[]),appTable=angular.module("appTable",["ngTable"]);app.controller("formController",["$scope","$http",function(e,o){"use strict";e.submitForm=function(){if(e.email){var t=o({method:"POST",url:"/models/validateLanding.php",data:{email:e.email},headers:{"Content-Type":"application/json"}});t.success(function(o){"regOk"===o?(e.requestResult="has-success",e.email=""):e.requestResult="emailErr"===o?"has-error-email":"has-error"})}}}]),app.controller("AdmLoginFormCtrl",["$scope","$http","$window",function(e,o,t){"use strict";e.submitForm=function(){if(e.username&&e.password){var n=o({method:"POST",url:"/models/validateAdminLogin.php",data:{username:e.username,password:Sha256.hash(e.password)},headers:{"Content-Type":"application/json"}});n.success(function(o){"loginOk"===o?(e.requestResult="has-success",t.location.href="http://"+t.location.host+"/admin/panel"):e.requestResult="has-error"}),n.error(function(){e.requestResult="has-error"})}},e.logout=function(){o({method:"POST",url:"/models/adminLogout.php",data:{session:e.session},headers:{"Content-Type":"application/json"}})}}]),app.controller("AdmEmailCtrl",["$scope","$http","$window",function(e,o,t){"use strict";e.deleteEmail=function(e){if(t.confirm("¿Seguro que quieres eliminar el email?")){var n=o({method:"POST",url:"/models/removeEmail.php",data:{emailid:e},headers:{"Content-Type":"application/json"}});n.success(function(e){"deleteOk"===e&&t.location.reload()})}}}]),appTable.controller("ComponentCtrl",["$scope","$http","$window","$filter","ngTableParams",function(e,o,t,n,s){"use strict";e.components=[],e.providers=[],e.numPerPage=8;var a=t.screen.availHeight;768>=a?e.numPerPage=8:a>768&&900>=a?e.numPerPage=10:a>1080&&(e.numPerPage=15),$("#tableproducts").hide(),e.getComponents=function(t){var a=o({method:"POST",url:"/models/getSpecificComponent.php",data:{component:t},headers:{"Content-Type":"application/json"}});a.success(function(o){var a;if("cpus"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][6],family:o[a][2],socket:o[a][4],cores:o[a][5],freq:o[a][1],price:parseFloat(o[a][3])});if("gpus"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][4],frequency:o[a][1],memory:o[a][2],price:parseFloat(o[a][3])});if("cpucoolers"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][5],rpm:o[a][2],noise:o[a][3],size:o[a][1],price:parseFloat(o[a][4])});if("motherboards"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][2],socket:o[a][3],price:parseFloat(o[a][1])});if("memories"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][5],frequency:o[a][1],modules:o[a][2],size:o[a][3],price:parseFloat(o[a][4])});if("powersupplies"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][4],watts:o[a][1],eficiency:o[a][2],price:parseFloat(o[a][3])});if("cases"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][3],format:o[a][1],price:o[a][2]});if("opticaldrives"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][2],price:o[a][1]});if("storages"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][5],capacity:o[a][1],format:o[a][2],type:o[a][3],price:o[a][4]});if("monitors"===t)for(a=0;a<o.length;a++)e.components.push({id:o[a][0],name:o[a][4],resolution:o[a][1],size:o[a][2],price:o[a][3]});$("#loadspin").hide(),$("#tableproducts").show(),e.tableParams=new s({page:1,count:8,sorting:{name:"asc"}},{total:e.components.length,getData:function(o,t){var s=t.filter()?n("filter")(e.components,t.filter()):e.components;s=t.sorting()?n("orderBy")(s,t.orderBy()):s,t.total(s.length),$("#loadspin").hide(),o.resolve(s.slice((t.page()-1)*t.count(),t.page()*t.count()))}})})},e.getProviders=function(t,a){var r=o({method:"POST",url:"/models/getComponentProviders.php",data:{compPn:t,compType:a},headers:{"Content-Type":"application/json"}});r.success(function(o){var t;for(t=0;t<o.length;t++)e.providers.push({name:o[t].name,price:o[t].price,"delivery-fare":o[t]["delivery-fare"],total:o[t].total,pos:t});$("#loadspin").hide(),$("#tableproducts").show(),e.tableParams=new s({page:1,count:8,sorting:{name:"asc"}},{total:e.providers.length,getData:function(o,t){var s=t.filter()?n("filter")(e.providers,t.filter()):e.providers;s=t.sorting()?n("orderBy")(s,t.orderBy()):s,t.total(s.length),$("#loadspin").hide(),o.resolve(s.slice((t.page()-1)*t.count(),t.page()*t.count()))}})})},e.addComponent=function(n,s){e.component1=s.substring(0,s.length-1),"memorie"===e.component1&&(e.component1="memory"),"opticaldrive"===e.component1&&(e.component1="optical-drive"),"powersupplie"===e.component1&&(e.component1="power-supply");var a=o({method:"POST",url:"/partList/select/"+e.component1,data:{productId:n,productVendorName:$("#product-vendor").val(),productPrice:$("#product-price").val()},headers:{"Content-Type":"application/json"}});a.success(function(){t.location.href="/partList"})}}]),appTable.controller("insertionController",["$scope","$http","$filter","$window","ngTableParams",function(e,o,t,n,s){"use strict";e.nameJson=[],e.selection=[],$("#loadSpin").hide(),$("#tableJson").hide(),$("#insertionData").hide(),e.getNameJson=function(){$("#startInsertion").hide();var n=o({method:"POST",url:"/models/getDocJson.php",data:{url2:"../crawler/data/originals"},headers:{"Content-Type":"application/json"}});n.success(function(o){var n;for($("#loadSpin").show(),n=0;n<o.length;n++)e.nameJson.push({name:o[n].name});e.tableParams=new s({page:1,count:9,sorting:{name:"asc"}},{total:e.nameJson.length,getData:function(o,n){var s=n.filter()?t("filter")(e.nameJson,n.filter()):e.nameJson;s=n.sorting()?t("orderBy")(s,n.orderBy()):s,n.total(s.length),o.resolve(s.slice((n.page()-1)*n.count(),n.page()*n.count())),$("#loadSpin").hide(),$("#tableJson").show()}})}),$("#insertionData").show()},e.addJson=function(o){var t,n;if(0===e.selection.length)e.selection.push(o),e["return"]="";else{for(e.selec=e.selection,e.selection=[],t=0;t<e.selec.length;t++)e.selec[t]!==o?(e.selection.push(e.selec[t]),n=0):n=1;0===n&&e.selection.push(o)}},e.insertJson=function(){if(0===e.selection.length)e["return"]="Por favor, selecciona un documento";else{window.alert("¿Desea continuar?");var t=o({method:"POST",url:"/db/insertComponents.php",data:{docs:e.selection},headers:{"Content-Type":"application/json"}});t.success(function(o){"ok"===o?(e["return"]="Datos insertados correctamente.",e.selection=[],$("input:checkbox").removeAttr("checked")):e["return"]="No se ha han insertado los datos correctamente."})}}}]),app.controller("totalCostController",["$scope",function(e){"use strict";$("#totalCostid").hide(),e.totalCostFin="",e.totalCostString="",e.calculateCost=function(o){e.totalCostString=o,e.totalCostFin=e.totalCostString.split("€"),e.totalCostFin=parseFloat(e.totalCostFin[0]),0!==e.totalCostFin&&$("#totalCostid").show()}}]);